# Сборка на gulp с нуля



### Вся сборка делится на 3 блока:
*Каждый последующий блок является продолжением предыдущего*   

:house: **[Базовая сборка](#базовая-сборка)** – может автоматически конвертировать scss в css;    
:post_office: **[Продвинутая сборка](#продвинутая-сборка)** – параллельная работа нескольких тасков, автоматическая перезагрузка страницы, объединение js файлов;    
:european_castle: **Полная сборка** – подключаение сторонних плагинов.    

Ниже показан процесс создания сборки на Gulp с подробным описанием каждой команды. Если вы не хотите смотреть всю инструкцию, вы можете найти готовую сборку в папке [completed_setup]() из данного репозитория.

Для установки сборки на новый проект, вам панадобятся только эти файлы — *app*, *gulpfile.js*, *package.json*. Процесс инициализации сборки в новом проекте можно посмотреть [здесь]().




# Базовая сборка

#### 1. Устанавливаем Node.js 
Его можно скачать на [сайте](https://nodejs.org/en/). Процесс установки не отличается от других програм.

#### 2. Устанавливаем Gulp (глобально)
На сайте gulp есть подробная [интрукция](https://gulpjs.com/docs/en/getting-started/quick-start) по установке. Скажу лишь, что устанавливать gulp глобально нужно только один раз. В последующих проектах нужна лишь локальная установка. 

Создаем папку с будущей сборкой. Назовем ее *gulp-start*. Открываем командную строку с привязкой к папке (на [видео](https://youtu.be/izqR0UY11rk?t=317) подробнее про это) и пишем в ней следующее:
```js
//Глобальная установка
npm install --global gulp-cli
```

#### 3. Инициализируем новый проект
```js
npm init
```
В ответ на команду, консолька спрашивает у нас, какое мы хотим задать имя проекта, версию, описание и тд. [Ссылка](https://youtu.be/izqR0UY11rk?t=632) с тайм кодом. После этого у нас появляется файл *package.json*.

#### 4. Устанавливаем Gulp в проект (локально)
```js
npm i gulp --save-dev
```
Ключ `--save-dev` будет прописывать версию gulp в файл *package.json*. Это нужно для переноса файла с одного компа на другой.
После выполнения комванды у нас появляется папка node_moduls, в которой хранятся все модули для работы с gulp. В нее мы будем устанавливать jQuery плагины в полной сборке.

#### 5. Создаем файл *gulpfile.js*
В папке *gulp-start* создаем файл *gulpfile.js*, в котором будем писать настройки для нашего проекта

#### 6. Создаем структуру проекта в папке app
В папку *app* добавляем подпапки для различных файлов: шрифты, изображения, js, scss и тд. Папку для css мы не будем создавать, так как она будет создана автоматически (про это буде написано дальше). Также создадим файл *index.html* в который сразу подключим будующий css и js файлы. [Ссылка](https://youtu.be/izqR0UY11rk?t=1302) с тайм кодом. 
```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="css/style.min.css">
</head>
<body>

    <script src="js/libs.min.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
```

#### 7. Пишим инструкцию для компиляции scss в css
В файле *gulpfile.js* создаем переменную gulp, которой присваеваем результат работы одноименного модуля из папки *node_modules*.
```js
//метод require загружает модуль 
let gulp = require('gulp');
```
Скачиваем и устанавливаем плагин для компиляции scss в css. Пишем в консоли:
```
npm i gulp-sass --save-dev
```
После установки, в папке *node_modules* должен появиться папка gulp-sass. Так же в файлу *package.json* появится строка `"gulp-sass": "^4.1.0"` (версия может быть другой).    

В файле *gulpfile.js* пишем таск (некое задание, которое будет выполнять gulp), [ссылка](https://youtu.be/izqR0UY11rk?t=1831) с тайм кодом. Он будет брать файлы scss и компилировать (трансформировать) в css:
```js
//Создаем переменную для вызова этого таска
let sass = require('gulp-sass');

//Пишим сам таск
gulp.task('scss', function(){
    return gulp.src('app/scss/**/*.scss')  //метод .src выбирает все файлы, указаные в скобках
        .pipe(sass({outputStyle: 'expanded'}))  //метод .pipe добавляет файлы в поток для чтения, для последующей записи
        .pipe(gulp.dest('app/css'))  //метод .dest указывает, куда положить файлы
});
```
Для проверки нашего таска, мы можем прописать пару стилей в *style.scss*. После чего выполнить таск, написав в командной строке его название
```
gulp scss
```
В результате у нас создастся папка *css* с файлом *style.css*. Если мы поменяем что-то в файле *style.scss* и сохраним файл — ничего не произойдет. Нужно заного вызвать команду `gulp scss`.

#### 8. Пишим инструкцию для автоматического выполнения команды `gulp scss`
Если мы будем что-то менять в файле *style.scss*, gulp будет автоматически компилировать код из scss в css. [Ссылка](https://youtu.be/izqR0UY11rk?t=2574) с тайм кодом.
```js
gulp.task('watch', function(){
    gulp.watch('app/scss/**/*.scss', gulp.parallel('scss'))  //слежение за файлами, при выполнении таска. Если в них будут изменения, запускаем таск scss
})
```
Запускаем команду gulp watch через командную строку и производим изменения в *style.scss*. Если все ок, файл *style.css* обновляется автоматически.




# Продвинутая сборка

#### 1. Устанавливаем плагин для автоматической перезагрузки страницы
Ставим плагин browsersync. Для этого пишем в командной строке:
```
npm i browser-sync --save-dev 
```
После чего пишем таск для автоматической перезангрузки страницы, который создаст сервер с выбранной нами дерикторией
```js
let browserSync = require('browser-sync');

gulp.task('browser-sync', function () {
    browserSync.init({  //создаем сервер
        server: {
            baseDir: "app/"     //выбираем дерикторию сервера
        }
    });
});
```
Для того, чтобы в нашей сборке параллельно работало сразу несколько тасков, содадим дефолтный таск
```js
gulp.task('default', gulp.parallel('browser-sync', 'watch'))
```
На текущий момент у нас будет запускаться сервер, но не будет автоматически обновляться страница при изменении в файлах **.scss**. Чтобы это исправить, добавим еще один `.pipe` в таск `scss`
```js
gulp.task('scss', function(){
        ...
        .pipe(browserSync.reload({stream: true}))
});
```
Чтобы проверить работоспособность всего вышенаписанного, пишем `gulp` в командной строке для того чтобы запустить сервер.
